# DRCTransformer

---

***class* drcompress.transformer.DRCTransformer(threshold=`None`, coef=`0.5`, method=`'power'`, side=`'max'`, dry=`0.0`)**

---

Избавляйтесь от влияния выбросов в данных или от `OOD` *(out of distribution)*, как на тренировочных, так и на тестовых данных.

Появление данного метода вдохновлено историей появления первых компрессоров аудио-сигнала на радио-станциях, которые должны были оберегать дорогую аппаратуру от неожиданных всеплесков сигнала на аудио дорожках.

*\* Трансформер полностью совместим с библиотекой **Scikit-Learn** и распрастроняется по лицензии **MIT**.*

---

**Параметры:**

>Если значение параметра передано, как `None`, то будет использовано значение параметра по умолчанию, кроме `threshold`, его случай описан в описании параметра.
>
>Если значение параметра передано, как `int` или `float`, то оно будет использовано для всех признаков, которые попадают в входные данные трансформера, так и на все стороны распределения значений признаков, при **side=`'both'`**.
>
>Чтобы при **side=`'both'`** передать для каждой стороны разные значения параметра, необходимо передать значения в формате `list` или `tuple`: 
>
>- `[param_min, param_max]`
>- `(param_min, param_max)`
>
>Чтобы передать для каждого признака соответствующее значения параметра, их необходимо передать в том же порядке и в формате `list` или `tuple`: 
>
>- `[2, 5, (2, 6), [8, 10]]`
>- `(2, 5, (2, 6), [8, 10])`

**threshold : *(int, float, list, tuple), default=None***

Порог срабатывания трансформера *(требуется абсолютное значение)*, при передачи значения `None` порог устанавливается автоматически:

- При **side=`'max'`** —  максимальное значение каждого признака выборки, на которой обучен трансформер;
- При **side=`'min'`** —  минимальное значение каждого признака выборки, на которой обучен трансформер;
- При **side=`'both'`** —  максимальное и минимальное значения каждого признака выборки, на которой обучен трансформер.

**coef : *(int, float, list, tuple), default=0.5***

*\*Гиперпараметр должен быть больше* `0`.

- Для **method=`'linear'`** — коэффициент линейного компрессирования;
- Для **method=`'power'`** — степень компрессирования;
- Для **method=`'log'`** — масштабирующий коэффициент логарифмического компрессирования; 
- Для **method=`'clip'`** — неактивен.

**side : *(str, list), default='max'***
            
Сторона сжатия распределения значений. Доступные методы:

- **`'max'`** — трансформер обрабатывает максимальные значения распределения;
- **`'min'`** — трансформер обрабатывает минимальные значения распределения;
- **`'both'`** — трансформер обрабатываем, как максимальные, так и минимальные значения распределения.

**method : *(str, list, tuple), default='power'***
            
Предполагается 4 метода преобразования значений, доступные методы:

*\*Все формулы описаны для варианта **side=`'max'`***

- **`'linear'`** — линейное преобразования значений;

$$
f(x) = 
\begin{cases}
x, & x \leq \text{threshold} \\
\text{threshold} + \text{coef} \cdot (x - \text{threshold}), & x > \text{threshold}
\end{cases}
$$

- **`'power'`** — степенное преобразование значений;

$$
f(x) = 
\begin{cases}
x, & x \leq \text{threshold} \\
\text{threshold} + (x - \text{threshold} - 1)^\text{coef} + 1 , & x > \text{threshold}
\end{cases}
$$

- **`'log'`** — логарифмическое преобразование значений;

$$
f(x) = 
\begin{cases}
x, & x \leq \text{threshold} \\
\text{threshold} + \text{coef} \cdot \text{ln}(x - \text{threshold} + 1), & x > \text{threshold}
\end{cases}
$$

- **`'clip'`** — замена значений, которые превысили **threshold**, на значение **threshold**.

$$
f(x) = 
\begin{cases}
x, & x \leq \text{threshold} \\
\text{threshold}, & x > \text{threshold}
\end{cases}
$$


**dry : *(int, float, list, tuple), default=0.0***

*\*Гиперпараметр должен быть в диапозоне* `[0, 1]`.

Доля исходных значений в результате (`0.0` = полная компрессия, `1.0` = без изменений).
После преобразования значений расчитывается средневзвешенное значение для исходных данных и преобразованных.

$$
\text{dry} \cdot Original + (1 - \text{dry}) \cdot Compressed
$$

---

**Атрибуты:**

**threshold_ : *(int, float, list, tuple)***

Значение или значения порогов срабатывания трансформера для каждого признака.

**coef_ : *(int, float, list, tuple)***

Значние или значения коэффициентов для каждого признака и выбранного для него метода компрессии.

**side_ : *(str, list)***

Значение или значения выбранной стороны для каждого признака, которую будет обрабатывать трансформер.

**method_ : *(str, list, tuple)***

Значение или значения выбранного метода компрессии для каждого признака, которым будет обрабатывать значения трансформер.

**dry_ : *(int, float, list, tuple)***

**n_features_in_ : *int***

Количество признаков, на которых обучен трансформер.

**feature_names_in_ : *ndarray of shape (n_features_in_,)***

Названия признаков, которые были в данных во время обучения трансформера. Определяются только в том случае, если признаки имеют названия, которые являются строками.

---

**Заметки:**

Данный трансформер не работает с ***NaN***, будет сгенерирована ошибка.

---

**Примеры:**

>**Базовая компрессия:**

```python
>>>import numpy as np
>>>from drcompress import DRCTransformer
>>>X = np.array([[1.0], [2.0], [10.0]])       
>>>drc = DRCTransformer(threshold=7.0, 
                        coef=0.5, 
                        method='power', 
                        side='max', 
                        dry=0.0)
>>>X_comp = drc.fit_transform(X)
>>>print(X_comp)
[[1.]
 [2.]
 [8.]]
```

>**Смешанная компрессия:**

```python
>>>import numpy as np
>>>from drcompress import DRCTransformer
>>>X = np.array([[-10.0], [0.0], [10.0]])
>>>drc = DRCTransformer(threshold=[-5.0, 7.0], 
                        coef=[0.5, 0.5], 
                        method=['linear', 'power'], 
                        side='both',
                        dry=0.0)
>>>X_comp = drc.fit_transform(X)
>>>print(X_comp)
[[-7.5]
 [ 0. ]
 [ 8. ]]
```

>**Компрессия нескольких признаков одновременно:**

```python
>>>import pandas as pd
>>>from drcompress import DRCTransformer
>>>X = pd.DataFrame({'a': [0, 1, 10], 
                     'b': [-45, 0, 15], 
                     'c': [-10, 0, 10]})
>>>print(X)
    a   b   c
0   0 -45 -10
1   1   0   0
2  10  15  10
>>>drc = DRCTransformer(threshold=[5, 0, (-7, 7)], 
                        coef=0.5, 
                        method=['linear', ('clip', 'power'), 'power'], 
                        side=['max', 'both', 'both'], 
                        dry=0.0)
>>>X_comp = drc.fit_transform(X)
>>>X_comp = pd.DataFrame(X_comp, columns=drc.get_feature_names_out())
>>>print(X_comp)
     a    b    c
0  0.0 -0.0 -8.0
1  1.0 -0.0 -0.0
2  7.5  3.0  8.0
```

---

**fit(*X, y=None*)**

Расчет и валидация значений параметров.

***Параметры:***

>**X : *(array-like, sparse matrix) of shape (n_samples, n_features)***
>
>Данные, которые необходмо использовать для обучения трансформера.
>
>**y : *None***
>
>Игнорируется.

***Возвращает:***

>**self : *object***
>
>Обученный трансформер.

---

**fit_transform(*X, y=None*)**

Обучение трансформера на данных **X** и их преобразование, **y** игнорируется. 

***Параметры:***

>**X : *array-like, sparse matrix of shape (n_samples, n_features)***
>
>Входные данные.
>
>**y : *array-like of shape (n_samples,) or (n_samples, n_outputs), default=None***
>
>Значения таргета *(Игнорируются трансформером)*.

***Возвращает:***

>**X_compressed : *ndarray array of shape (n_samples, n_features_compressed)***
>
>Преобразованный массив.

---

**get_feature_names_out(*input_features=None*)**

Получить имена признаков, которые были получены для обучения трансформера.

***Параметры:*** 

>**input_features : *array-like of str or None, default=None***
>
>Названия признаков.
>
>Если **input_features=*None***, тогда **feature_names_in_** будет использовать те имена, что были у признаков в входных данных. Если **feature_names_in_** не определен, тогда будут сгенерированы имена: `["col_0", "col_1", ..., "col_(n_features_in_ - 1)"]`.
>
>Если **input_features** является массивом, то длина **input_features** должна совпадать с длиной **feature_names_in_**, если **feature_names_in_** определен.

***Возвращает:***

>**feature_names_out : *ndarray of str objects***
>
>То, что подается в входные данные.

---

**get_params(*deep=True*)**

Параметры, которые были заданы при инициализации трансформера.

***Параметры:*** 

>**deep : *bool, default=True***
>
>Если ***True***, вернет параметры для этого оценщика и содержащихся в нем подобъектов, которые являются оценщиками.

***Возвращает:***

>**params : *dict***
>
>Имена параметров, сопоставленные с их значениями.

---

**transform(*X*)**

Преобразование данных.

***Параметры:*** 

>**X : *array-like, sparse matrix of shape (n_samples, n_features)***
>
>Входные данные для преобразования.

***Возвращает:***

>**X_compressed : *ndarray array of shape (n_samples, n_features_compressed)***
>
>Преобразованный массив.